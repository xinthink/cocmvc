<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>cocmvc by xinthink</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>cocmvc</h1>
        <p>Convention Over Configuration extension to Spring Web MVC</p>
        <p class="view"><a href="https://github.com/xinthink/cocmvc">View the Project on GitHub <small>xinthink/cocmvc</small></a></p>
        <ul>
          <li><a href="https://github.com/xinthink/cocmvc/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/xinthink/cocmvc/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/xinthink/cocmvc">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Convention Over Configuration extension to <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html">Spring Web MVC</a>
</h1>

<h2>Why we need this extension</h2>

<p>Often, we develope web applications with the powerful Spring Web MVC in these two ways (or both of them):</p>

<ol>
<li>
<a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-coc">Convention over configuration support</a>

<ul>
<li>help omitting many 'redundant' configurations</li>
<li>but we must have our controllers implementing a framework specific interface, reducing the flexibility</li>
</ul>
</li>
<li>
<a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-controller">Annotation-driven</a>

<ul>
<li>very powerful request mappings, and flexible handler method declarations</li>
<li>but it's actual configurations, sometimes seems to be 'redundant'</li>
</ul>
</li>
</ol><p>Both of them are pretty good, but there's no way to put them together in a single controller, you have to make the choice, and tolerate the redundancy.</p>

<p>But now, with the cocmvc extension, one is allowed to write a controller like this:</p>

<div class="highlight"><pre><span class="c1">// maps to /hello</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>

  <span class="c1">// handling /hello</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">(</span><span class="n">Model</span> <span class="n">modle</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">modle</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"this's the home page of hello"</span><span class="o">);</span>
    <span class="c1">// view-id = 'hello'</span>
  <span class="o">}</span>

  <span class="c1">// handling /hello/delete?id=1</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// view-id = 'hello/delete</span>
  <span class="o">}</span>

  <span class="c1">// handling /hello/show/1</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"show/{id}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// view-id = 'hello/show'</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Well, it combines the advantages of Spring's <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-coc">COC support</a> and <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-controller">annotation-driven</a> together, and I think it's also concise, and DRY.</p>

<p>Let's see how to do that.</p>

<h2>Developing by convention</h2>

<h3>URL pattern</h3>

<p>By convention, the URL pattern is:</p>

<pre><code>&lt;context-root&gt;/&lt;module&gt;/&lt;controller&gt;/&lt;action&gt;
</code></pre>

<ul>
<li>
<em>module</em>

<ul>
<li>modularity, it's a good idea to package controllers into modules in a big application</li>
<li>can recursively contain other sub-modules, such as: <code>news/sports/football</code>
</li>
<li>must provide a <code>basePackage</code> to enable modularity, the relative path (to the <code>basePackage</code>) of a controller will be used as it's module; otherwise, the module part will always be empty ('')</li>
</ul>
</li>
<li>
<em>controller</em>

<ul>
<li>just like Spring or Grails, controller class named <code>AbcController</code> will be mapped to <code>/abc</code>
</li>
<li>supports camel-case style (by default) or snake-case style, i.e. <code>helloWorld</code>, or <code>hello-world</code>
</li>
</ul>
</li>
<li>
<em>action</em>

<ul>
<li>mapped to action methods (request handlers), each public method of the controller will be mapped as an <code>action</code>
</li>
<li>method named <code>index</code> is a special case, it will be treated as the home page of the controller (the <code>/</code> action)</li>
<li>also by convention, <code>init</code> and <code>destroy</code> are life-cycle methods of a Spring bean, the framework will NOT treat them as actions</li>
<li>you can choose camel-case style (by default) or snake-case style</li>
</ul>
</li>
</ul><h3>Controllers</h3>

<h4>Coding a controller</h4>

<ul>
<li>Naming

<ul>
<li>Name your controller class with a 'Controller' suffix, for example: <code>LoginController</code>, <code>UserRegisterController</code>
</li>
<li>A controller class may extends any base class or implements any interface</li>
</ul>
</li>
<li>Packaging

<ul>
<li>You can put your controllers under any packages as you need</li>
<li>By setting a <code>basePackage</code>, controllers will be grouped into modules, for example, the module name of <code>basePackage.abc.def.HelloController</code> is 'abc/def', and it will be responsible to the URL <code>/abc/def/hello</code>
</li>
</ul>
</li>
<li>Write action methods

<ul>
<li>Public methods of a controller are all action methods, including methods inherited from base classes, excluding methods declared in <code>Object</code>, such as <code>toString</code>, <code>hashCode</code> ...</li>
<li>You can define an action method in any form supported by <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-ann-methods">Spring Web MVC</a>
</li>
</ul>
</li>
</ul><h4>Make controller a Spring bean</h4>

<p>XML configuration, component scanning ... </p>

<p>Feel free to choose the way most fit to your project, but the component scanning way seems to be more DRY.</p>

<h3>View templates</h3>

<p>By convention, the view-id of each action is corresponding to the requesting URL, i.e. view-id for action <code>/hello/show</code> is 'hello/show'</p>

<p>So, you can ommit the view-id return value (or when instantiating the <code>ModelAndView</code>), if you comply with the conventional view templates layout</p>

<p>For example (assume you're using jsp):</p>

<pre><code>views                                   Root of your view templates, may be /WEB-INF/views
  |
  |-- &lt;controller&gt;                      Views folder for top-level controllers
  |     |-- &lt;action&gt;.jsp                View templates
  |     \-- ...                 
  |
  |-- &lt;module&gt;                          Views folder for module
  |     |-- &lt;sub-module&gt;                Sub-module, recursively
  |     |     |-- &lt;controller&gt;
  |     |     |     |-- &lt;action&gt;.jsp    
  |     |     |     \-- ...
  |     |     \-- ...
  |     |
  |     |-- &lt;controller&gt;                Views folder for controller
  |     |     |-- &lt;action&gt;.jsp          View templates
  |     |     \-- ...             
  |     \-- ...                  
  |
  |-- index.jsp                         Top-level view templates, home page, error page etc.
  \-- ...
</code></pre>

<h2>Overrides the convention</h2>

<p>You can override the convention by using <a href="http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html#mvc-controller">annotations (configurations)</a>.</p>

<p>For example, I'd like the home page located at <code>/</code>, instead of <code>/home</code></p>

<div class="highlight"><pre><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeController</span> <span class="o">{</span>

  <span class="c1">// handling /</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">retrun</span> <span class="s">"index"</span><span class="o">;</span> <span class="c1">// view-id = 'index'</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>or, to use path variables</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonController</span> <span class="o">{</span>

  <span class="c1">// handling /person/show</span>
  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"show/{id}"</span><span class="o">)</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="c1">// view-id = 'person/show'</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>and sometimes, some special public methods should not be treated as actions</p>

<div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonController</span> <span class="o">{</span>

  <span class="nd">@NoMapping</span>
  <span class="nd">@ModelAttribute</span>
  <span class="kd">public</span> <span class="n">Person</span> <span class="nf">addModelAttribute</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Person</span><span class="o">();</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<h2>Project dependencies</h2>

<p>Before enjoy developing by convention, you should first add cocmvc to your project dependencies.</p>

<p>Add the following snippet in your gradle build script, or something equivalent in other dependencies management tools:</p>

<pre><code>repositories {
    mavenCentral()
    mavenRepo url: 'https://raw.github.com/xinthink/repo/master'
}

dependencies {
    runtime 'xink.spring:cocmvc:0.1'
}
</code></pre>

<h2>Configurations</h2>

<p>Huh, there's also a little configuration job to be done, in order to override the default behavior of Spring framework.</p>

<div class="highlight"><pre><span class="c">&lt;!-- close spring's annotation-driven to avoid duplicated URL mapping --&gt;</span>
<span class="c">&lt;!--&lt;mvc:annotation-driven /&gt;--&gt;</span>

<span class="c">&lt;!-- add this line to make our action methods to be adapted as request Handlers --&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span> <span class="nt">/&gt;</span>

<span class="c">&lt;!-- Enable conventional developing mode,</span>
<span class="c">  and provides a basePacakge to enabled the modularity feature</span>
<span class="c">--&gt;</span>
<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"net.sf.cocmvc.ConventionalHandlerMapping"</span> <span class="na">p:basePackage=</span><span class="s">"com.abc.controller"</span> <span class="nt">/&gt;</span>
</pre></div>

<p>Enjoy!</p>

<h4>Please refer to the <a href="https://github.com/xinthink/cocmvc/tree/master/sample">sample project</a> for more details.</h4>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/xinthink">xinthink</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-33049696-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>